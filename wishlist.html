<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Wishlist — AhamStree</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/styles.css" />
</head>

<body>
  <div id="header"></div>

  <div class="container" style="padding-top: 40px; padding-bottom: 40px;">
    <h1 style="font-size: 32px; margin-bottom: 8px;">My Wishlist</h1>
    <p style="color: var(--text-light); margin-bottom: 32px;">
      Your saved sarees
    </p>

    <div id="wishlistStatus" style="text-align: center; padding: 20px;"></div>
    <div id="wishlistGrid" class="grid grid-3"></div>
  </div>

  <div id="footer"></div>

  <script type="module">
    import { renderHeader, renderFooter, hydrateHeaderAuth } from "/assets/ui.js";
    import { getWishlist, removeFromWishlist } from "/assets/wishlist.js";

    document.getElementById("header").innerHTML = renderHeader();
    hydrateHeaderAuth();
    document.getElementById("footer").innerHTML = renderFooter();

    const wishlistGrid = document.getElementById('wishlistGrid');
    const wishlistStatus = document.getElementById('wishlistStatus');

    // Load wishlist
    loadWishlist();

    async function loadWishlist() {
      wishlistStatus.textContent = 'Loading...';

      const { data: products, error } = await getWishlist();

      if (error) {
        wishlistStatus.textContent = 'Error loading wishlist';
        return;
      }

      wishlistStatus.textContent = '';

      if (!products || products.length === 0) {
        wishlistGrid.innerHTML = `
          <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
            <p style="font-size: 18px; color: var(--text-light); margin-bottom: 20px;">
              Your wishlist is empty
            </p>
            <a href="products.html" class="btn">Browse Products</a>
          </div>
        `;
        return;
      }

      wishlistGrid.innerHTML = products.map(product => `
        <div class="card product-card">
          <a href="product.html?id=${product.id}">
            <img src="${product.images?.[0] || 'assets/images/placeholder.jpg'}" 
                 alt="${product.name}"
                 loading="lazy">
          </a>
          <div class="p">
            <a href="product.html?id=${product.id}" style="text-decoration: none; color: inherit;">
              <div class="product-title">${product.name}</div>
              <div class="product-price">₹${product.price.toLocaleString('en-IN')}</div>
            </a>
            <button 
              class="btn secondary" 
              style="width: 100%; margin-top: 12px;"
              onclick="removeItem(${product.id})">
              Remove
            </button>
          </div>
        </div>
      `).join('');
    }

    // Make removeItem available globally
    window.removeItem = async function(productId) {
      if (!confirm('Remove this item from wishlist?')) return;

      const { success } = await removeFromWishlist(productId);
      if (success) {
        loadWishlist();
      }
    };
  </script>
</body>
</html>
